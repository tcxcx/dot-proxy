{"version":3,"file":"from-worker.mjs","sources":["../../../src/from-worker.ts"],"sourcesContent":["import type { Client } from \"smoldot\"\nimport {\n  type SmoldotBytecode,\n  type ClientOptionsWithBytecode,\n  startWithBytecode,\n} from \"smoldot/no-auto-bytecode\"\n\nexport type SmoldotOptions = Omit<\n  ClientOptionsWithBytecode,\n  \"bytecode\" | \"portToWorker\"\n>\n\nexport const startFromWorker = (\n  worker: Worker,\n  options: SmoldotOptions = {},\n): Client => {\n  const bytecode = new Promise<SmoldotBytecode>((resolve) => {\n    worker.onmessage = (event) => resolve(event.data)\n  })\n\n  const { port1, port2 } = new MessageChannel()\n  worker.postMessage(port1, [port1])\n\n  return startWithBytecode({\n    bytecode,\n    portToWorker: port2,\n    ...options,\n  })\n}\n"],"names":[],"mappings":";;AAYO,MAAM,eAAkB,GAAA,CAC7B,MACA,EAAA,OAAA,GAA0B,EACf,KAAA;AACX,EAAA,MAAM,QAAW,GAAA,IAAI,OAAyB,CAAA,CAAC,OAAY,KAAA;AACzD,IAAA,MAAA,CAAO,SAAY,GAAA,CAAC,KAAU,KAAA,OAAA,CAAQ,MAAM,IAAI,CAAA;AAAA,GACjD,CAAA;AAED,EAAA,MAAM,EAAE,KAAA,EAAO,KAAM,EAAA,GAAI,IAAI,cAAe,EAAA;AAC5C,EAAA,MAAA,CAAO,WAAY,CAAA,KAAA,EAAO,CAAC,KAAK,CAAC,CAAA;AAEjC,EAAA,OAAO,iBAAkB,CAAA;AAAA,IACvB,QAAA;AAAA,IACA,YAAc,EAAA,KAAA;AAAA,IACd,GAAG;AAAA,GACJ,CAAA;AACH;;;;"}