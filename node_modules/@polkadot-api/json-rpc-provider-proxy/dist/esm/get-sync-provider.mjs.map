{"version":3,"file":"get-sync-provider.mjs","sources":["../../src/get-sync-provider.ts"],"sourcesContent":["import type { JsonRpcProvider } from \"@polkadot-api/json-rpc-provider\"\nimport { getProxy } from \"./get-proxy\"\nimport { AsyncJsonRpcProvider } from \"./public-types\"\nimport { ConnectableJsonRpcConnection } from \"./internal-types\"\n\nexport const getSyncProvider =\n  (input: () => Promise<AsyncJsonRpcProvider>): JsonRpcProvider =>\n  (onMessage) => {\n    let proxy: ConnectableJsonRpcConnection | null = getProxy(onMessage)\n\n    const start = () => {\n      input().then(\n        (cb) => {\n          if (!proxy) {\n            try {\n              cb(\n                () => {},\n                () => {},\n              ).disconnect()\n            } catch (_) {}\n          } else\n            proxy.connect((onMsg, onHalt) =>\n              cb(onMsg, () => {\n                onHalt()\n                start()\n              }),\n            )\n        },\n        () => {\n          proxy && setTimeout(start, 0)\n        },\n      )\n    }\n\n    start()\n    return {\n      send: (msg) => {\n        proxy?.send(msg)\n      },\n      disconnect: () => {\n        proxy?.disconnect()\n        proxy = null\n      },\n    }\n  }\n"],"names":[],"mappings":";;AAKO,MAAM,eACX,GAAA,CAAC,KACD,KAAA,CAAC,SAAc,KAAA;AACb,EAAI,IAAA,KAAA,GAA6C,SAAS,SAAS,CAAA;AAEnE,EAAA,MAAM,QAAQ,MAAM;AAClB,IAAA,KAAA,EAAQ,CAAA,IAAA;AAAA,MACN,CAAC,EAAO,KAAA;AACN,QAAA,IAAI,CAAC,KAAO,EAAA;AACV,UAAI,IAAA;AACF,YAAA,EAAA;AAAA,cACE,MAAM;AAAA,eAAC;AAAA,cACP,MAAM;AAAA;AAAC,cACP,UAAW,EAAA;AAAA,mBACN,CAAG,EAAA;AAAA;AAAC,SACf;AACE,UAAM,KAAA,CAAA,OAAA;AAAA,YAAQ,CAAC,KAAA,EAAO,MACpB,KAAA,EAAA,CAAG,OAAO,MAAM;AACd,cAAO,MAAA,EAAA;AACP,cAAM,KAAA,EAAA;AAAA,aACP;AAAA,WACH;AAAA,OACJ;AAAA,MACA,MAAM;AACJ,QAAS,KAAA,IAAA,UAAA,CAAW,OAAO,CAAC,CAAA;AAAA;AAC9B,KACF;AAAA,GACF;AAEA,EAAM,KAAA,EAAA;AACN,EAAO,OAAA;AAAA,IACL,IAAA,EAAM,CAAC,GAAQ,KAAA;AACb,MAAA,KAAA,EAAO,KAAK,GAAG,CAAA;AAAA,KACjB;AAAA,IACA,YAAY,MAAM;AAChB,MAAA,KAAA,EAAO,UAAW,EAAA;AAClB,MAAQ,KAAA,GAAA,IAAA;AAAA;AACV,GACF;AACF;;;;"}