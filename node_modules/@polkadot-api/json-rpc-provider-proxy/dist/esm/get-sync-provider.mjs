import { getProxy } from './get-proxy.mjs';

const getSyncProvider = (input) => (onMessage) => {
  let proxy = getProxy(onMessage);
  const start = () => {
    input().then(
      (cb) => {
        if (!proxy) {
          try {
            cb(
              () => {
              },
              () => {
              }
            ).disconnect();
          } catch (_) {
          }
        } else
          proxy.connect(
            (onMsg, onHalt) => cb(onMsg, () => {
              onHalt();
              start();
            })
          );
      },
      () => {
        proxy && setTimeout(start, 0);
      }
    );
  };
  start();
  return {
    send: (msg) => {
      proxy?.send(msg);
    },
    disconnect: () => {
      proxy?.disconnect();
      proxy = null;
    }
  };
};

export { getSyncProvider };
//# sourceMappingURL=get-sync-provider.mjs.map
