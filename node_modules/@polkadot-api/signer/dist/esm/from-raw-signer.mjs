import { mergeUint8 } from '@polkadot-api/utils';
import { getSignBytes, createV4Tx } from '@polkadot-api/signers-common';
import { Blake2256, decAnyMetadata } from '@polkadot-api/substrate-bindings';

function getPolkadotSigner(publicKey, signingType, sign) {
  const signTx = async (callData, signedExtensions, metadata, _, hasher = Blake2256) => {
    let decMeta;
    try {
      const tmpMeta = decAnyMetadata(metadata);
      if (tmpMeta.metadata.tag !== "v14" && tmpMeta.metadata.tag !== "v15")
        throw null;
      decMeta = tmpMeta.metadata.value;
    } catch (_2) {
      throw new Error("Unsupported metadata version");
    }
    const extra = [];
    const additionalSigned = [];
    decMeta.extrinsic.signedExtensions.map(({ identifier }) => {
      const signedExtension = signedExtensions[identifier];
      if (!signedExtension)
        throw new Error(`Missing ${identifier} signed extension`);
      extra.push(signedExtension.value);
      additionalSigned.push(signedExtension.additionalSigned);
    });
    const toSign = mergeUint8(callData, ...extra, ...additionalSigned);
    const signed = await sign(toSign.length > 256 ? hasher(toSign) : toSign);
    return createV4Tx(decMeta, publicKey, signed, extra, callData, signingType);
  };
  return {
    publicKey,
    signTx,
    signBytes: getSignBytes(sign)
  };
}

export { getPolkadotSigner };
//# sourceMappingURL=from-raw-signer.mjs.map
