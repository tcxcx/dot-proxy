{"version":3,"file":"parsed.mjs","sources":["../../src/parsed.ts"],"sourcesContent":["import { JsonRpcProvider } from \"@polkadot-api/json-rpc-provider\"\n\nexport interface ParsedJsonRpcConnection {\n  send: <T extends {}>(message: T) => void\n  disconnect: () => void\n}\n\nexport type ParsedJsonRpcProvider = (\n  onMesage: <T extends {}>(message: T) => void,\n) => ParsedJsonRpcConnection\n\nexport type ParsedJsonRpcEnhancer = (\n  base: ParsedJsonRpcProvider,\n) => ParsedJsonRpcProvider\n\nexport const toParsed = (base: JsonRpcProvider): ParsedJsonRpcProvider => {\n  let _onMsg: null | (<T extends {}>(msg: T) => void) = null\n  const { send, disconnect } = base((msg) => {\n    _onMsg?.(JSON.parse(msg))\n  })\n\n  return (onMsg) => {\n    _onMsg = onMsg\n    return {\n      send(msg) {\n        send(JSON.stringify(msg))\n      },\n      disconnect() {\n        _onMsg = null\n        disconnect()\n      },\n    }\n  }\n}\n\nexport const fromParsed = (base: ParsedJsonRpcProvider): JsonRpcProvider => {\n  let _onMsg: null | ((msg: string) => void) = null\n  const { send, disconnect } = base((msg) => {\n    _onMsg?.(JSON.stringify(msg))\n  })\n\n  return (onMsg) => {\n    _onMsg = onMsg\n    return {\n      send(msg) {\n        send(JSON.parse(msg))\n      },\n      disconnect() {\n        _onMsg = null\n        disconnect()\n      },\n    }\n  }\n}\n\nexport const parsed =\n  (\n    ...enhancers: Array<ParsedJsonRpcEnhancer>\n  ): ((base: JsonRpcProvider) => JsonRpcProvider) =>\n  (base) =>\n    fromParsed(enhancers.reduce((a, b) => b(a), toParsed(base)))\n"],"names":[],"mappings":"AAea,MAAA,QAAA,GAAW,CAAC,IAAiD,KAAA;AACxE,EAAA,IAAI,MAAkD,GAAA,IAAA;AACtD,EAAA,MAAM,EAAE,IAAM,EAAA,UAAA,EAAe,GAAA,IAAA,CAAK,CAAC,GAAQ,KAAA;AACzC,IAAS,MAAA,GAAA,IAAA,CAAK,KAAM,CAAA,GAAG,CAAC,CAAA;AAAA,GACzB,CAAA;AAED,EAAA,OAAO,CAAC,KAAU,KAAA;AAChB,IAAS,MAAA,GAAA,KAAA;AACT,IAAO,OAAA;AAAA,MACL,KAAK,GAAK,EAAA;AACR,QAAK,IAAA,CAAA,IAAA,CAAK,SAAU,CAAA,GAAG,CAAC,CAAA;AAAA,OAC1B;AAAA,MACA,UAAa,GAAA;AACX,QAAS,MAAA,GAAA,IAAA;AACT,QAAW,UAAA,EAAA;AAAA;AACb,KACF;AAAA,GACF;AACF;AAEa,MAAA,UAAA,GAAa,CAAC,IAAiD,KAAA;AAC1E,EAAA,IAAI,MAAyC,GAAA,IAAA;AAC7C,EAAA,MAAM,EAAE,IAAM,EAAA,UAAA,EAAe,GAAA,IAAA,CAAK,CAAC,GAAQ,KAAA;AACzC,IAAS,MAAA,GAAA,IAAA,CAAK,SAAU,CAAA,GAAG,CAAC,CAAA;AAAA,GAC7B,CAAA;AAED,EAAA,OAAO,CAAC,KAAU,KAAA;AAChB,IAAS,MAAA,GAAA,KAAA;AACT,IAAO,OAAA;AAAA,MACL,KAAK,GAAK,EAAA;AACR,QAAK,IAAA,CAAA,IAAA,CAAK,KAAM,CAAA,GAAG,CAAC,CAAA;AAAA,OACtB;AAAA,MACA,UAAa,GAAA;AACX,QAAS,MAAA,GAAA,IAAA;AACT,QAAW,UAAA,EAAA;AAAA;AACb,KACF;AAAA,GACF;AACF;AAEO,MAAM,SACX,CACK,GAAA,SAAA,KAEL,CAAC,IAAA,KACC,WAAW,SAAU,CAAA,MAAA,CAAO,CAAC,CAAA,EAAG,MAAM,CAAE,CAAA,CAAC,GAAG,QAAS,CAAA,IAAI,CAAC,CAAC;;;;"}