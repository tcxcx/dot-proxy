{"version":3,"file":"self-dependent.mjs","sources":["../../../src/utils/self-dependent.ts"],"sourcesContent":["import {\n  Observable,\n  Subject,\n  MonoTypeOperatorFunction,\n  BehaviorSubject,\n} from \"rxjs\"\nimport { switchAll, tap } from \"rxjs/operators\"\n\n/**\n * A creation operator that helps at creating observables that have circular\n * dependencies.\n *\n * @returns\n */\nexport const selfDependent = <T>(): [\n  Observable<T>,\n  () => MonoTypeOperatorFunction<T>,\n] => {\n  const activeSubject: BehaviorSubject<Subject<T>> = new BehaviorSubject(\n    new Subject<T>(),\n  )\n  return [\n    activeSubject.pipe(switchAll()),\n    () =>\n      tap({\n        next: (v) => activeSubject.value.next(v),\n        error: (e) => {\n          activeSubject.value.error(e)\n          activeSubject.next(new Subject<T>())\n        },\n        complete: () => {\n          activeSubject.value.complete()\n          activeSubject.next(new Subject<T>())\n        },\n      }) as MonoTypeOperatorFunction<T>,\n  ]\n}\n"],"names":[],"mappings":";;;AAcO,MAAM,gBAAgB,MAGxB;AACH,EAAA,MAAM,gBAA6C,IAAI,eAAA;AAAA,IACrD,IAAI,OAAW;AAAA,GACjB;AACA,EAAO,OAAA;AAAA,IACL,aAAA,CAAc,IAAK,CAAA,SAAA,EAAW,CAAA;AAAA,IAC9B,MACE,GAAI,CAAA;AAAA,MACF,MAAM,CAAC,CAAA,KAAM,aAAc,CAAA,KAAA,CAAM,KAAK,CAAC,CAAA;AAAA,MACvC,KAAA,EAAO,CAAC,CAAM,KAAA;AACZ,QAAc,aAAA,CAAA,KAAA,CAAM,MAAM,CAAC,CAAA;AAC3B,QAAc,aAAA,CAAA,IAAA,CAAK,IAAI,OAAA,EAAY,CAAA;AAAA,OACrC;AAAA,MACA,UAAU,MAAM;AACd,QAAA,aAAA,CAAc,MAAM,QAAS,EAAA;AAC7B,QAAc,aAAA,CAAA,IAAA,CAAK,IAAI,OAAA,EAAY,CAAA;AAAA;AACrC,KACD;AAAA,GACL;AACF;;;;"}