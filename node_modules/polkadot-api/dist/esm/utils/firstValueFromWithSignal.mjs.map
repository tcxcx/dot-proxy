{"version":3,"file":"firstValueFromWithSignal.mjs","sources":["../../../src/utils/firstValueFromWithSignal.ts"],"sourcesContent":["import { AbortError } from \"@polkadot-api/utils\"\nimport { Observable, Subscription, noop } from \"rxjs\"\n\nexport function firstValueFromWithSignal<T>(\n  source: Observable<T>,\n  signal?: AbortSignal,\n): Promise<T> {\n  return new Promise((resolve, reject) => {\n    let subscription: Subscription | null = null\n    let isDone = false\n\n    const onAbort = signal\n      ? () => {\n          subscription?.unsubscribe()\n          reject(new AbortError())\n        }\n      : noop\n\n    subscription = source.subscribe({\n      next: (value) => {\n        resolve(value)\n        subscription?.unsubscribe()\n        isDone = true\n      },\n      error: (e) => {\n        signal?.removeEventListener(\"abort\", onAbort)\n        reject(e)\n        isDone = true\n      },\n      complete: () => {\n        signal?.removeEventListener(\"abort\", onAbort)\n        reject(new Error(\"Observable completed without emitting\"))\n        isDone = true\n      },\n    })\n\n    // the observable could have emitted synchronously\n    if (!isDone) signal?.addEventListener(\"abort\", onAbort)\n  })\n}\n"],"names":[],"mappings":";;;AAGgB,SAAA,wBAAA,CACd,QACA,MACY,EAAA;AACZ,EAAA,OAAO,IAAI,OAAA,CAAQ,CAAC,OAAA,EAAS,MAAW,KAAA;AACtC,IAAA,IAAI,YAAoC,GAAA,IAAA;AACxC,IAAA,IAAI,MAAS,GAAA,KAAA;AAEb,IAAM,MAAA,OAAA,GAAU,SACZ,MAAM;AACJ,MAAA,YAAA,EAAc,WAAY,EAAA;AAC1B,MAAO,MAAA,CAAA,IAAI,YAAY,CAAA;AAAA,KAEzB,GAAA,IAAA;AAEJ,IAAA,YAAA,GAAe,OAAO,SAAU,CAAA;AAAA,MAC9B,IAAA,EAAM,CAAC,KAAU,KAAA;AACf,QAAA,OAAA,CAAQ,KAAK,CAAA;AACb,QAAA,YAAA,EAAc,WAAY,EAAA;AAC1B,QAAS,MAAA,GAAA,IAAA;AAAA,OACX;AAAA,MACA,KAAA,EAAO,CAAC,CAAM,KAAA;AACZ,QAAQ,MAAA,EAAA,mBAAA,CAAoB,SAAS,OAAO,CAAA;AAC5C,QAAA,MAAA,CAAO,CAAC,CAAA;AACR,QAAS,MAAA,GAAA,IAAA;AAAA,OACX;AAAA,MACA,UAAU,MAAM;AACd,QAAQ,MAAA,EAAA,mBAAA,CAAoB,SAAS,OAAO,CAAA;AAC5C,QAAO,MAAA,CAAA,IAAI,KAAM,CAAA,uCAAuC,CAAC,CAAA;AACzD,QAAS,MAAA,GAAA,IAAA;AAAA;AACX,KACD,CAAA;AAGD,IAAA,IAAI,CAAC,MAAA,EAAgB,MAAA,EAAA,gBAAA,CAAiB,SAAS,OAAO,CAAA;AAAA,GACvD,CAAA;AACH;;;;"}