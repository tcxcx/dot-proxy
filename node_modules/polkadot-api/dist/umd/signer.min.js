(function(z,X){typeof exports=="object"&&typeof module<"u"?X(exports):typeof define=="function"&&define.amd?define(["exports"],X):(z=typeof globalThis<"u"?globalThis:z||self,X(z.papiSigner={}))})(this,function(z){"use strict";const X="0123456789abcdef";function ve(e){const t=new Array(e.length+1);t[0]="0x";for(let n=0;n<e.length;){const r=e[n++];t[n]=X[r>>4]+X[r&15]}return t.join("")}const pe={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function ye(e){const t=e.length%2,n=(e[1]==="x"?2:0)+t,r=(e.length-n)/2+t,s=new Uint8Array(r);t&&(s[0]=0|pe[e[2]]);for(let i=0;i<r;){const o=n+i*2,c=pe[e[o]],d=pe[e[o+1]];s[t+i++]=c<<4|d}return s}const Y=(...e)=>{const t=e.reduce((r,s)=>r+s.byteLength,0),n=new Uint8Array(t);for(let r=0,s=0;r<e.length;r++){const i=e[r];n.set(i,s),s+=i.byteLength}return n};var vt=Object.defineProperty,pt=(e,t,n)=>t in e?vt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_e=(e,t,n)=>(pt(e,typeof t!="symbol"?t+"":t,n),n),ge={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};function yt(e){const t=e.length%2,n=(e[1]==="x"?2:0)+t,r=(e.length-n)/2+t,s=new Uint8Array(r);t&&(s[0]=0|ge[e[2]]);for(let i=0;i<r;){const o=n+i*2,c=ge[e[o]],d=ge[e[o+1]];s[t+i++]=c<<4|d}return s}var ke=class extends Uint8Array{constructor(e){super(e),_e(this,"i",0),_e(this,"v"),this.v=new DataView(e)}},S=e=>t=>e(t instanceof ke?t:new ke(t instanceof Uint8Array?t.buffer:typeof t=="string"?yt(t).buffer:t)),T=e=>{const t=e.length;let n=0;for(let s=0;s<t;s++)n+=e[s].length;const r=new Uint8Array(n);for(let s=0,i=0;s<t;s++){const o=e[s];r.set(o,i),i+=o.byteLength}return r};function re(e,t){const n=Object.keys(e),r=n.length,s={};for(let i=0;i<r;i++){const o=n[i];s[o]=t(e[o],o)}return s}var b=(e,t)=>{const n=[e,t];return n.enc=e,n.dec=t,n},we=(e,t)=>n=>e(t(n)),Le=(e,t)=>n=>t(e(n)),se=([e,t],n,r)=>b(we(e,n),Le(t,r));function gt(e,t){return S(n=>{const r=n.v[t](n.i,!0);return n.i+=e,r})}function wt(e,t){return n=>{const r=new Uint8Array(e);return new DataView(r.buffer)[t](0,n,!0),r}}function $(e,t,n){return b(wt(e,n),gt(e,t))}var U=$(1,"getUint8","setUint8"),ie=$(2,"getUint16","setUint16"),F=$(4,"getUint32","setUint32"),Se=$(8,"getBigUint64","setBigUint64");$(1,"getInt8","setInt8"),$(2,"getInt16","setInt16"),$(4,"getInt32","setInt32"),$(8,"getBigInt64","setBigInt64");var Te=e=>{const t=new Uint8Array(16),n=new DataView(t.buffer);return n.setBigInt64(0,e,!0),n.setBigInt64(8,e>>64n,!0),t},De=e=>S(t=>{const{v:n,i:r}=t,s=n.getBigUint64(r,!0),i=n[e](r+8,!0);return t.i+=16,i<<64n|s});b(Te,De("getBigUint64")),b(Te,De("getBigInt64"));var Oe=e=>{const t=new Uint8Array(32),n=new DataView(t.buffer);return n.setBigInt64(0,e,!0),n.setBigInt64(8,e>>64n,!0),n.setBigInt64(16,e>>128n,!0),n.setBigInt64(24,e>>192n,!0),t},He=e=>S(t=>{let n=t.v.getBigUint64(t.i,!0);return t.i+=8,n|=t.v.getBigUint64(t.i,!0)<<64n,t.i+=8,n|=t.v.getBigUint64(t.i,!0)<<128n,t.i+=8,n|=t.v[e](t.i,!0)<<192n,t.i+=8,n});b(Oe,He("getBigUint64")),b(Oe,He("getBigInt64")),se(U,e=>e?1:0,Boolean);var mt=[U[1],ie[1],F[1]],xt=S(e=>{const t=e[e.i],n=t&3;if(n<3)return mt[n](e)>>>2;const r=(t>>>2)+4;e.i++;let s=0n;const i=r/8|0;let o=0n;for(let d=0;d<i;d++)s=Se[1](e)<<o|s,o+=64n;let c=r%8;return c>3&&(s=BigInt(F[1](e))<<o|s,o+=32n,c-=4),c>1&&(s=BigInt(ie[1](e))<<o|s,o+=16n,c-=2),c&&(s=BigInt(U[1](e))<<o|s),s}),Bt=1n<<56n,Et=1<<24,bt=256,At=4294967295n,It=64,Ut=16384,_t=1<<30,kt=e=>{if(e<0)throw new Error(`Wrong compact input (${e})`);const t=Number(e)<<2;if(e<It)return U[0](t);if(e<Ut)return ie[0](t|1);if(e<_t)return F[0](t|2);let n=[new Uint8Array(1)],r=BigInt(e);for(;r>=Bt;)n.push(Se[0](r)),r>>=64n;r>=Et&&(n.push(F[0](Number(r&At))),r>>=32n);let s=Number(r);s>=bt&&(n.push(ie[0](s)),s>>=16),s&&n.push(U[0](s));const i=T(n);return i[0]=i.length-5<<2|3,i},L=b(kt,xt),Lt=new TextEncoder,St=e=>{const t=Lt.encode(e);return T([L.enc(t.length),t])},Tt=new TextDecoder,Dt=S(e=>{let t=L.dec(e);const n=new DataView(e.buffer,e.i,t);return e.i+=t,Tt.decode(n)}),_=b(St,Dt),Ot=()=>{},Ht=new Uint8Array(0),m=b(()=>Ht,Ot),Me=e=>e===void 0?t=>T([L.enc(t.length),t]):t=>t.length===e?t:t.slice(0,e),Ce=e=>S(t=>{const n=e===void 0?L.dec(t):e!==1/0?e:t.byteLength-t.i,r=new Uint8Array(t.buffer.slice(t.i,t.i+n));return t.i+=n,r}),j=e=>b(Me(e),Ce(e));j.enc=Me,j.dec=Ce;var $e=(e,t)=>{const n=Object.keys(e),r=new Map(t?.map((i,o)=>[n[o],i])??n.map((i,o)=>[i,o])),s=i=>r.get(i);return({tag:i,value:o})=>T([U.enc(s(i)),e[i](o)])},Ne=(e,t)=>{const n=Object.keys(e),r=new Map(t?.map((s,i)=>[s,n[i]])??n.map((s,i)=>[i,s]));return S(s=>{const i=U.dec(s),o=r.get(i),c=e[o];return{tag:o,value:c(s)}})},q=(e,...t)=>b($e(re(e,([n])=>n),...t),Ne(re(e,([,n])=>n),...t));q.enc=$e,q.dec=Ne;var Ve=e=>S(t=>U[1](t)>0?e(t):void 0),Pe=e=>t=>{const n=new Uint8Array(1);return t===void 0?n:(n[0]=1,T([n,e(t)]))},D=e=>b(Pe(e[0]),Ve(e[1]));D.enc=Pe,D.dec=Ve;var je=(...e)=>S(t=>e.map(n=>n(t))),qe=(...e)=>t=>T(e.map((n,r)=>n(t[r]))),R=(...e)=>b(qe(...e.map(([t])=>t)),je(...e.map(([,t])=>t)));R.enc=qe,R.dec=je;var Re=e=>{const t=Object.keys(e);return we(R.enc(...Object.values(e)),n=>t.map(r=>n[r]))},Ke=e=>{const t=Object.keys(e);return Le(R.dec(...Object.values(e)),n=>Object.fromEntries(n.map((r,s)=>[t[s],r])))},w=e=>b(Re(re(e,t=>t[0])),Ke(re(e,t=>t[1])));w.enc=Re,w.dec=Ke;var We=(e,t)=>t>=0?n=>T(n.map(e)):n=>T([L.enc(n.length),T(n.map(e))]),Xe=(e,t)=>S(n=>{const r=t>=0?t:L.dec(n),s=new Array(r);for(let i=0;i<r;i++)s[i]=e(n);return s}),B=(e,t)=>b(We(e[0],t),Xe(e[1],t));B.enc=We,B.dec=Xe;/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Mt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Fe(e,t){return Array.isArray(t)?t.length===0?!0:e?t.every(n=>typeof n=="string"):t.every(n=>Number.isSafeInteger(n)):!1}function me(e,t){if(typeof t!="string")throw new Error(`${e}: string expected`);return!0}function Ge(e){if(!Number.isSafeInteger(e))throw new Error(`invalid integer: ${e}`)}function xe(e){if(!Array.isArray(e))throw new Error("array expected")}function ze(e,t){if(!Fe(!0,t))throw new Error(`${e}: array of strings expected`)}function Ct(e,t){if(!Fe(!1,t))throw new Error(`${e}: array of numbers expected`)}function $t(...e){const t=i=>i,n=(i,o)=>c=>i(o(c)),r=e.map(i=>i.encode).reduceRight(n,t),s=e.map(i=>i.decode).reduce(n,t);return{encode:r,decode:s}}function Nt(e){const t=typeof e=="string"?e.split(""):e,n=t.length;ze("alphabet",t);const r=new Map(t.map((s,i)=>[s,i]));return{encode:s=>(xe(s),s.map(i=>{if(!Number.isSafeInteger(i)||i<0||i>=n)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${e}`);return t[i]})),decode:s=>(xe(s),s.map(i=>{me("alphabet.decode",i);const o=r.get(i);if(o===void 0)throw new Error(`Unknown letter: "${i}". Allowed: ${e}`);return o}))}}function Vt(e=""){return me("join",e),{encode:t=>(ze("join.decode",t),t.join(e)),decode:t=>(me("join.decode",t),t.split(e))}}function Ye(e,t,n){if(t<2)throw new Error(`convertRadix: invalid from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: invalid to=${n}, base cannot be less than 2`);if(xe(e),!e.length)return[];let r=0;const s=[],i=Array.from(e,c=>{if(Ge(c),c<0||c>=t)throw new Error(`invalid integer: ${c}`);return c}),o=i.length;for(;;){let c=0,d=!0;for(let p=r;p<o;p++){const v=i[p],u=t*c,l=u+v;if(!Number.isSafeInteger(l)||u/t!==c||l-v!==u)throw new Error("convertRadix: carry overflow");const g=l/n;c=l%n;const h=Math.floor(g);if(i[p]=h,!Number.isSafeInteger(h)||h*n+c!==l)throw new Error("convertRadix: carry overflow");if(d)h?d=!1:r=p;else continue}if(s.push(c),d)break}for(let c=0;c<e.length-1&&e[c]===0;c++)s.push(0);return s.reverse()}function Pt(e){Ge(e);const t=2**8;return{encode:n=>{if(!Mt(n))throw new Error("radix.encode input should be Uint8Array");return Ye(Array.from(n),t,e)},decode:n=>(Ct("radix.decode",n),Uint8Array.from(Ye(n,e,t)))}}const Je=(e=>$t(Pt(58),Nt(e),Vt("")))("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");function Be(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, got "+e)}function jt(e){return e instanceof Uint8Array||ArrayBuffer.isView(e)&&e.constructor.name==="Uint8Array"}function Qe(e,...t){if(!jt(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error("Uint8Array expected of length "+t+", got length="+e.length)}function Ze(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function qt(e,t){Qe(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function oe(e){return new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4))}const K=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function et(e){return e<<24&4278190080|e<<8&16711680|e>>>8&65280|e>>>24&255}const O=K?e=>e:e=>et(e);function G(e){for(let t=0;t<e.length;t++)e[t]=et(e[t])}function Rt(e){if(typeof e!="string")throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array(new TextEncoder().encode(e))}function J(e){return typeof e=="string"&&(e=Rt(e)),Qe(e),e}class Kt{clone(){return this._cloneInto()}}function Wt(e){const t=(r,s)=>e(s).update(J(r)).digest(),n=e({});return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=r=>e(r),t}const Xt=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]);class Ft extends Kt{constructor(t,n,r={},s,i,o){if(super(),this.blockLen=t,this.outputLen=n,this.length=0,this.pos=0,this.finished=!1,this.destroyed=!1,Be(t),Be(n),Be(s),n<0||n>s)throw new Error("outputLen bigger than keyLen");if(r.key!==void 0&&(r.key.length<1||r.key.length>s))throw new Error("key length must be undefined or 1.."+s);if(r.salt!==void 0&&r.salt.length!==i)throw new Error("salt must be undefined or "+i);if(r.personalization!==void 0&&r.personalization.length!==o)throw new Error("personalization must be undefined or "+o);this.buffer=new Uint8Array(t),this.buffer32=oe(this.buffer)}update(t){Ze(this);const{blockLen:n,buffer:r,buffer32:s}=this;t=J(t);const i=t.length,o=t.byteOffset,c=t.buffer;for(let d=0;d<i;){this.pos===n&&(K||G(s),this.compress(s,0,!1),K||G(s),this.pos=0);const p=Math.min(n-this.pos,i-d),v=o+d;if(p===n&&!(v%4)&&d+p<i){const u=new Uint32Array(c,v,Math.floor((i-d)/4));K||G(u);for(let l=0;d+n<i;l+=s.length,d+=n)this.length+=n,this.compress(u,l,!1);K||G(u);continue}r.set(t.subarray(d,d+p),this.pos),this.pos+=p,this.length+=p,d+=p}return this}digestInto(t){Ze(this),qt(t,this);const{pos:n,buffer32:r}=this;this.finished=!0,this.buffer.subarray(n).fill(0),K||G(r),this.compress(r,0,!0),K||G(r);const s=oe(t);this.get().forEach((i,o)=>s[o]=O(i))}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){const{buffer:n,length:r,finished:s,destroyed:i,outputLen:o,pos:c}=this;return t||(t=new this.constructor({dkLen:o})),t.set(...this.get()),t.length=r,t.finished=s,t.destroyed=i,t.outputLen=o,t.buffer.set(n),t.pos=c,t}}const ce=BigInt(2**32-1),Ee=BigInt(32);function tt(e,t=!1){return t?{h:Number(e&ce),l:Number(e>>Ee&ce)}:{h:Number(e>>Ee&ce)|0,l:Number(e&ce)|0}}function Gt(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let s=0;s<e.length;s++){const{h:i,l:o}=tt(e[s],t);[n[s],r[s]]=[i,o]}return[n,r]}const zt=(e,t)=>BigInt(e>>>0)<<Ee|BigInt(t>>>0),Yt=(e,t,n)=>e>>>n,Jt=(e,t,n)=>e<<32-n|t>>>n,Qt=(e,t,n)=>e>>>n|t<<32-n,Zt=(e,t,n)=>e<<32-n|t>>>n,en=(e,t,n)=>e<<64-n|t>>>n-32,tn=(e,t,n)=>e>>>n-32|t<<64-n,nn=(e,t)=>t,rn=(e,t)=>e,sn=(e,t,n)=>e<<n|t>>>32-n,on=(e,t,n)=>t<<n|e>>>32-n,cn=(e,t,n)=>t<<n-32|e>>>64-n,an=(e,t,n)=>e<<n-32|t>>>64-n;function ln(e,t,n,r){const s=(t>>>0)+(r>>>0);return{h:e+n+(s/2**32|0)|0,l:s|0}}const I={fromBig:tt,split:Gt,toBig:zt,shrSH:Yt,shrSL:Jt,rotrSH:Qt,rotrSL:Zt,rotrBH:en,rotrBL:tn,rotr32H:nn,rotr32L:rn,rotlSH:sn,rotlSL:on,rotlBH:cn,rotlBL:an,add:ln,add3L:(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),add3H:(e,t,n,r)=>t+n+r+(e/2**32|0)|0,add4L:(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),add4H:(e,t,n,r,s)=>t+n+r+s+(e/2**32|0)|0,add5H:(e,t,n,r,s,i)=>t+n+r+s+i+(e/2**32|0)|0,add5L:(e,t,n,r,s)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(s>>>0)},E=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),a=new Uint32Array(32);function N(e,t,n,r,s,i){const o=s[i],c=s[i+1];let d=a[2*e],p=a[2*e+1],v=a[2*t],u=a[2*t+1],l=a[2*n],g=a[2*n+1],h=a[2*r],f=a[2*r+1],x=I.add3L(d,v,o);p=I.add3H(x,p,u,c),d=x|0,{Dh:f,Dl:h}={Dh:f^p,Dl:h^d},{Dh:f,Dl:h}={Dh:I.rotr32H(f,h),Dl:I.rotr32L(f,h)},{h:g,l}=I.add(g,l,f,h),{Bh:u,Bl:v}={Bh:u^g,Bl:v^l},{Bh:u,Bl:v}={Bh:I.rotrSH(u,v,24),Bl:I.rotrSL(u,v,24)},a[2*e]=d,a[2*e+1]=p,a[2*t]=v,a[2*t+1]=u,a[2*n]=l,a[2*n+1]=g,a[2*r]=h,a[2*r+1]=f}function V(e,t,n,r,s,i){const o=s[i],c=s[i+1];let d=a[2*e],p=a[2*e+1],v=a[2*t],u=a[2*t+1],l=a[2*n],g=a[2*n+1],h=a[2*r],f=a[2*r+1],x=I.add3L(d,v,o);p=I.add3H(x,p,u,c),d=x|0,{Dh:f,Dl:h}={Dh:f^p,Dl:h^d},{Dh:f,Dl:h}={Dh:I.rotrSH(f,h,16),Dl:I.rotrSL(f,h,16)},{h:g,l}=I.add(g,l,f,h),{Bh:u,Bl:v}={Bh:u^g,Bl:v^l},{Bh:u,Bl:v}={Bh:I.rotrBH(u,v,63),Bl:I.rotrBL(u,v,63)},a[2*e]=d,a[2*e+1]=p,a[2*t]=v,a[2*t+1]=u,a[2*n]=l,a[2*n+1]=g,a[2*r]=h,a[2*r+1]=f}class un extends Ft{constructor(t={}){super(128,t.dkLen===void 0?64:t.dkLen,t,64,16,16),this.v0l=E[0]|0,this.v0h=E[1]|0,this.v1l=E[2]|0,this.v1h=E[3]|0,this.v2l=E[4]|0,this.v2h=E[5]|0,this.v3l=E[6]|0,this.v3h=E[7]|0,this.v4l=E[8]|0,this.v4h=E[9]|0,this.v5l=E[10]|0,this.v5h=E[11]|0,this.v6l=E[12]|0,this.v6h=E[13]|0,this.v7l=E[14]|0,this.v7h=E[15]|0;const n=t.key?t.key.length:0;if(this.v0l^=this.outputLen|n<<8|65536|1<<24,t.salt){const r=oe(J(t.salt));this.v4l^=O(r[0]),this.v4h^=O(r[1]),this.v5l^=O(r[2]),this.v5h^=O(r[3])}if(t.personalization){const r=oe(J(t.personalization));this.v6l^=O(r[0]),this.v6h^=O(r[1]),this.v7l^=O(r[2]),this.v7h^=O(r[3])}if(t.key){const r=new Uint8Array(this.blockLen);r.set(J(t.key)),this.update(r)}}get(){let{v0l:t,v0h:n,v1l:r,v1h:s,v2l:i,v2h:o,v3l:c,v3h:d,v4l:p,v4h:v,v5l:u,v5h:l,v6l:g,v6h:h,v7l:f,v7h:x}=this;return[t,n,r,s,i,o,c,d,p,v,u,l,g,h,f,x]}set(t,n,r,s,i,o,c,d,p,v,u,l,g,h,f,x){this.v0l=t|0,this.v0h=n|0,this.v1l=r|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=c|0,this.v3h=d|0,this.v4l=p|0,this.v4h=v|0,this.v5l=u|0,this.v5h=l|0,this.v6l=g|0,this.v6h=h|0,this.v7l=f|0,this.v7h=x|0}compress(t,n,r){this.get().forEach((d,p)=>a[p]=d),a.set(E,16);let{h:s,l:i}=I.fromBig(BigInt(this.length));a[24]=E[8]^i,a[25]=E[9]^s,r&&(a[28]=~a[28],a[29]=~a[29]);let o=0;const c=Xt;for(let d=0;d<12;d++)N(0,4,8,12,t,n+2*c[o++]),V(0,4,8,12,t,n+2*c[o++]),N(1,5,9,13,t,n+2*c[o++]),V(1,5,9,13,t,n+2*c[o++]),N(2,6,10,14,t,n+2*c[o++]),V(2,6,10,14,t,n+2*c[o++]),N(3,7,11,15,t,n+2*c[o++]),V(3,7,11,15,t,n+2*c[o++]),N(0,5,10,15,t,n+2*c[o++]),V(0,5,10,15,t,n+2*c[o++]),N(1,6,11,12,t,n+2*c[o++]),V(1,6,11,12,t,n+2*c[o++]),N(2,7,8,13,t,n+2*c[o++]),V(2,7,8,13,t,n+2*c[o++]),N(3,4,9,14,t,n+2*c[o++]),V(3,4,9,14,t,n+2*c[o++]);this.v0l^=a[0]^a[16],this.v0h^=a[1]^a[17],this.v1l^=a[2]^a[18],this.v1h^=a[3]^a[19],this.v2l^=a[4]^a[20],this.v2h^=a[5]^a[21],this.v3l^=a[6]^a[22],this.v3h^=a[7]^a[23],this.v4l^=a[8]^a[24],this.v4h^=a[9]^a[25],this.v5l^=a[10]^a[26],this.v5h^=a[11]^a[27],this.v6l^=a[12]^a[28],this.v6h^=a[13]^a[29],this.v7l^=a[14]^a[30],this.v7h^=a[15]^a[31],a.fill(0)}destroy(){this.destroyed=!0,this.buffer32.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const be=Wt(e=>new un(e)),nt=new TextEncoder().encode("SS58PRE"),Ae=2,hn=e=>{try{const t=Je.decode(e),n=t.subarray(0,t[0]&64?2:1),r=t.subarray(n.length,t.length-Ae),s=t.subarray(n.length+r.length),i=be(Uint8Array.of(...nt,...n,...r),{dkLen:64}).subarray(0,Ae);return s[0]===i[0]&&s[1]===i[1]?{isValid:!0,ss58Format:dn(n),publicKey:r.slice()}:{isValid:!1}}catch{return{isValid:!1}}},dn=e=>{const t=new DataView(e.buffer,e.byteOffset,e.byteLength);return t.byteLength===1?t.getUint8(0):t.getUint16(0)},fn=e=>{const t=e<64?Uint8Array.of(e):Uint8Array.of((e&252)>>2|64,e>>8|(e&3)<<6);return n=>{const r=be(Uint8Array.of(...nt,...t,...n),{dkLen:64}).subarray(0,Ae);return Je.encode(Uint8Array.of(...t,...n,...r))}};function vn(e,t){return n=>{const r=hn(n);if(!r.isValid)throw new Error("Invalid checksum");const{publicKey:s}=r;if(s.length!==e)throw new Error("Invalid public key length");return s}}const pn=(e=42,t=32)=>se(j(t),vn(t),fn(e));var yn=Object.defineProperty,rt=e=>{throw TypeError(e)},gn=(e,t,n)=>t in e?yn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Q=(e,t,n)=>gn(e,typeof t!="symbol"?t+"":t,n),st=(e,t,n)=>t.has(e)||rt("Cannot "+n),H=(e,t,n)=>(st(e,t,"read from private field"),n?n.call(e):t.get(e)),Z=(e,t,n)=>t.has(e)?rt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),W=(e,t,n,r)=>(st(e,t,"write to private field"),t.set(e,n),n),M,ee,ae,le,ue;const wn=new TextEncoder,mn=new TextDecoder,xn=R(L,j(1/0))[1];class Bn{constructor(t,n=!1){if(Z(this,M),Z(this,ee,null),Z(this,ae,null),Z(this,le,null),Z(this,ue,null),Q(this,"asText",()=>H(this,ue)??W(this,ue,mn.decode(H(this,M)))),Q(this,"asHex",()=>H(this,ae)||W(this,ae,ve(H(this,M)))),Q(this,"asOpaqueHex",()=>H(this,le)||W(this,le,ve(this.asBytes()))),Q(this,"asBytes",()=>H(this,M)),Q(this,"asOpaqueBytes",()=>H(this,ee)||W(this,ee,Y(L[0](H(this,M).length),H(this,M)))),n){try{const[r,s]=xn(t);if(r===s.length){W(this,M,s),W(this,ee,t);return}}catch{}throw new Error("Invalid opaque bytes")}else W(this,M,t)}static fromText(t){return new this(wn.encode(t))}static fromHex(t){return new this(ye(t))}static fromOpaqueHex(t){return new this(ye(t),!0)}static fromBytes(t){return new this(t)}static fromOpaqueBytes(t){return new this(t,!0)}}M=new WeakMap,ee=new WeakMap,ae=new WeakMap,le=new WeakMap,ue=new WeakMap;const[ar]=pn(),y=se(L,e=>e,Number);se(L,e=>e,BigInt);const it=e=>{const t=j.enc(e);return n=>t(ye(n))},ot=e=>{const t=j.dec(e);return n=>ve(t(n))},te=e=>b(it(e),ot(e));te.enc=it,te.dec=ot;const C=B(_),ct=D(_),En=q({bool:m,char:m,str:m,u8:m,u16:m,u32:m,u64:m,u128:m,u256:m,i8:m,i16:m,i32:m,i64:m,i128:m,i256:m}),at=B(w({name:ct,type:y,typeName:ct,docs:C})),bn=w({len:F,type:y}),An=w({bitStoreType:y,bitOrderType:y}),In=B(w({name:_,fields:at,index:U,docs:C})),Un=q({composite:at,variant:In,sequence:y,array:bn,tuple:B(y),primitive:En,compact:y,bitSequence:An}),_n=w({name:_,type:D(y)}),kn=B(_n),Ln=w({id:y,path:C,params:kn,def:Un,docs:C}),lt=B(Ln),Sn=q({Blake2128:m,Blake2256:m,Blake2128Concat:m,Twox128:m,Twox256:m,Twox64Concat:m,Identity:m}),Tn=B(Sn),Dn=w({hashers:Tn,key:y,value:y}),On=w({name:_,modifier:U,type:q({plain:y,map:Dn}),fallback:te(),docs:C}),Hn=D(w({prefix:_,items:B(On)})),ut={name:_,storage:Hn,calls:D(y),events:D(y),constants:B(w({name:_,type:y,value:te(),docs:C})),errors:D(y),index:U},Mn={...ut,docs:C},Cn=new Uint8Array,ht=e=>b(()=>Cn,()=>e),$n=w({type:y,version:U,signedExtensions:B(w({identifier:_,type:y,additionalSigned:y}))}),Nn=w({lookup:lt,pallets:B(w({...ut,docs:ht([])})),extrinsic:$n,type:y,apis:ht([])}),Vn=w({name:_,methods:B(w({name:_,inputs:B(w({name:_,type:y})),output:y,docs:C})),docs:C}),Pn=w({version:U,address:y,call:y,signature:y,extra:y,signedExtensions:B(w({identifier:_,type:y,additionalSigned:y}))}),jn=w({lookup:lt,pallets:B(w(Mn)),extrinsic:Pn,type:y,apis:B(Vn),outerEnums:w({call:y,event:y,error:y}),custom:B(R(_,w({type:y,value:te()})))}),dt=()=>{throw new Error("Unsupported metadata version!")},k=b(dt,dt),he=w({magicNumber:F,metadata:q({v0:k,v1:k,v2:k,v3:k,v4:k,v5:k,v6:k,v7:k,v8:k,v9:k,v10:k,v11:k,v12:k,v13:k,v14:Nn,v15:jn})}),Ie=j(),qn=D(Ie),Rn=R(L,Ie),Kn=e=>{try{return he.dec(e)}catch{}try{return he.dec(qn.dec(e))}catch{}try{return he.dec(Ie.dec(e))}catch{}try{return he.dec(Rn.dec(e)[1])}catch{}throw null},Wn={dkLen:32},Xn=e=>be(e,Wn),ft=(e,t)=>e.type==="array"&&e.len===t&&e.value.type==="primitive"&&e.value.value==="u8",P={type:"void"},Fn=(e,t=()=>null)=>{const n=new Map,r=new Set,s=v=>u=>{let l=n.get(u);if(l)return l;if(r.has(u)){const h={id:u};return n.set(u,h),h}r.add(u);const g=v(u);return l=n.get(u),l?Object.assign(l,g):(l={id:u,...g},n.set(u,l)),r.delete(u),l};let i=!0,o=!0;const c=s(v=>{const u=t(e[v]);if(u)return u;const{def:l,path:g,params:h}=e[v];if(l.tag==="composite"){if(l.value.length===0)return P;if(l.value.length===1){const f=c(l.value[0].type);return i&&g.at(-1)==="AccountId32"&&ft(f,32)?(i=!1,{type:"AccountId32"}):o&&g.at(-1)==="AccountId20"&&ft(f,20)?(o=!1,{type:"AccountId20"}):f}return d(l.value)}if(l.tag==="variant"){if(g.length===1&&g[0]==="Option"&&h.length===1&&h[0].name==="T"){const A=c(h[0].type);return A.type==="void"?{type:"primitive",value:"bool"}:{type:"option",value:A}}if(g.length===1&&g[0]==="Result"&&h.length===2&&h[0].name==="T"&&h[1].name==="E")return{type:"result",value:{ok:c(h[0].type),ko:c(h[1].type)}};if(l.value.length===0)return P;const f={},x={};return l.value.forEach(A=>{const fe=A.name;if(x[fe]=A.docs,A.fields.length===0){f[fe]={...P,idx:A.index};return}if(A.fields.length===1&&!A.fields[0].name){f[fe]={type:"lookupEntry",value:c(A.fields[0].type),idx:A.index};return}f[fe]={...d(A.fields),idx:A.index}}),{type:"enum",value:f,innerDocs:x}}if(l.tag==="sequence")return{type:"sequence",value:c(l.value)};if(l.tag==="array"){const{len:f}=l.value,x=c(l.value.type);return!f||x.type==="void"?P:f>1?{type:"array",value:x,len:l.value.len}:x}if(l.tag==="tuple")return l.value.length===0?P:l.value.length>1?p(l.value.map(f=>c(f)),l.value.map(f=>e[f].docs)):c(l.value[0]);if(l.tag==="primitive")return{type:"primitive",value:l.value.tag};if(l.tag==="compact"){const f=c(l.value);return f.type==="void"?P:{type:"compact",isBig:Number(f.value.slice(1))>32,size:f.value}}return{type:l.tag}}),d=v=>{let u=!0;const l={},g={};return v.forEach((h,f)=>{u=u&&!!h.name;const x=h.name||f,A=c(h.type);A.type!=="void"&&(l[x]=A,g[x]=h.docs)}),u?{type:"struct",value:l,innerDocs:g}:p(Object.values(l),Object.values(g))},p=(v,u)=>{if(v.every(l=>l.id===v[0].id)&&u.every(l=>!l.length)){const[l]=v;return l.type==="void"?P:{type:"array",value:v[0],len:v.length}}return{type:"tuple",value:v,innerDocs:u}};return c},Gn=e=>{const t=Fn(e.lookup,({def:s})=>{if(s.tag==="composite"){const i=n(s);if(i)return{type:"enum",innerDocs:{},value:Object.fromEntries(e.pallets.map(o=>[o.name,o.errors==null?{...P,idx:o.index}:{type:"lookupEntry",value:t(o.errors),idx:o.index}])),byteLength:i}}return null});function n(s){if(!(s.value.length===2&&s.value[0].name==="index"&&s.value[1].name==="error"))return null;const o=t(s.value[0].type),c=t(s.value[1].type);return o.type==="primitive"&&o.value==="u8"&&c.type==="array"&&c.value.type==="primitive"&&c.value.value==="u8"?1+c.len:null}return Object.assign(t,{metadata:e,call:"outerEnums"in e?e.outerEnums.call:e.lookup[e.extrinsic?.type]?.params.find(o=>o.name==="Call")?.type??null})},zn=we(U.enc,e=>+!!e.signed<<7|e.version),Ue=()=>new Error("Unkown signer"),Yn=e=>{const{extrinsic:t}=e,n=Gn(e);let r,s;if("address"in t)r=n(t.address),s=n(t.signature);else{const i=Object.fromEntries(e.lookup[t.type].params.filter(o=>o.type!=null).map(o=>[o.name,n(o.type)]));if(r=i.Address,s=i.Signature,!r||!s)throw Ue()}if(r.type==="AccountId20"&&s.type==="array"&&s.len===65&&s.value.type==="primitive"&&s.value.value==="u8")return[1,[]];if(s.type!=="enum"||["Ecdsa","Ed25519","Sr25519"].some(i=>!(i in s.value)))throw Ue();if(r.type==="enum"){const i=r.value.Id;if(i.type==="lookupEntry"&&i.value.type==="AccountId32")return[0,[i.idx]]}else if(r.type==="AccountId32")return[0,[]];throw Ue()},Jn={Ed25519:0,Sr25519:1,Ecdsa:2},Qn=(e,t,n,r,s,i)=>{const[o,c]=Yn(e),d=Y(zn({signed:!0,version:4}),o===1?t:new Uint8Array([...c,...t]),o===1||!i?n:new Uint8Array([Jn[i],...n]),...r,s);return Y(L.enc(d.length),d)},[de,ne]=["<Bytes>","</Bytes>"].map(e=>Bn.fromText(e).asBytes()),Zn=e=>async t=>{let n=!0,r;for(r=0;n&&r<de.length;r++)n=de[r]===t[r];n=n&&r===de.length;const s=t.length-ne.length;for(r=0;n&&r<ne.length;r++)n=ne[r]===t[s+r];return n=n&&r===ne.length,e(n?t:Y(de,t,ne))};function er(e,t,n){return{publicKey:e,signTx:async(s,i,o,c,d=Xn)=>{let p;try{const h=Kn(o);if(h.metadata.tag!=="v14"&&h.metadata.tag!=="v15")throw null;p=h.metadata.value}catch{throw new Error("Unsupported metadata version")}const v=[],u=[];p.extrinsic.signedExtensions.map(({identifier:h})=>{const f=i[h];if(!f)throw new Error(`Missing ${h} signed extension`);v.push(f.value),u.push(f.additionalSigned)});const l=Y(s,...v,...u),g=await n(l.length>256?d(l):l);return Qn(p,e,g,v,s,t)},signBytes:Zn(n)}}z.getPolkadotSigner=er});
